<div class="row my-4">
  <% @products.each do |product| %>
    <div class="col-md-4 mt-2">
      <div class="card mb-3 p-3 h-100">
        <div class="row no-gutters">
          <div class="col-12 text-center">
            <h5 class="card-title"><%= product.name %></h5>
          </div>
          <div class="col-md-4">
            <a href="#" data-toggle="modal" data-target="#modal_product_<%= product.id %>">
              <%= image_tag(product.image_url, class: "img-thumbnail") %>
            </a>
          </div>
          <div class="col-md-8 d-flex align-items-end flex-column bd-highlight">
            <div class="card-body">
              <p class="card-text"><%= product.description.truncate(100) %></p>
            </div>
            <div class="col">
              <div class="alert alert-primary font-weight-bold text-center" role="alert">
                Oferta actual: <%= number_to_currency product.max_bid_amount %>
              </div>
            </div>
          </div>
        </div>
        <div class="col mt-3 d-flex align-items-end">
          <% if current_user %>
            <%= form_tag(Bid.new) do %>
              <div class="mb-3">
                <%= hidden_field_tag :product_id, product.id %>
                <div class="input-group is-invalid">
                  <div class="input-group-prepend">
                    <span class="input-group-text">$</span>
                  </div>
                  <%= number_field_tag "bids[amount]", "", id: "bid_amount_product_#{product.id}", class: "form-control mr-2", placeholder: product.next_bid_amount %>
                  <%= submit_tag "Ofertar", class: "btn btn-primary bid_amount" %>
                </div>
              </div>
            <% end %>
          <% else %>
            <%= link_to "RegÃ­strate para poder ofertar", new_registration_path(:user), class: "btn btn-primary" %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="modal fade" id="modal_product_<%= product.id %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel"><%= product.name %></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col d-flex justify-content-center">
                <div class="card mb-3 col-12 border-0">
                  <div class="row no-gutters p-4">
                    <div class="col-md-7 d-flex align-items-center">
                      <%= image_tag(product.image_url, class: "img-thumbnail") %>
                    </div>
                    <div class="col-md-5">
                      <div class="card-body">
                        <p class="card-text"><%= product.description %></p>
                      </div>
                      <div class="col">
                        <div class="alert alert-primary font-weight-bold text-center" role="alert">
                          Oferta actual: <%= number_to_currency(product.max_bid_amount) %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
